var cardForm,hasToken=!1,mercado_pago_submit=!1,triggeredPaymentMethodSelectedEvent=!1,cardFormReady=!1,cardFormMounted=!1,form=document.querySelector("form[name=checkout]"),formId="checkout";function mercadoPagoFormHandler(){if(document.querySelector("form[id=order_review]")){document.querySelector(".mp-checkout-custom-container").querySelectorAll("input-helper").forEach((e=>{"none"!=e.querySelector("div").style.display&&removeBlockOverlay()}))}return!!mercado_pago_submit||("wallet_button"===jQuery("#mp_checkout_type").val()||(jQuery("#mp_checkout_type").val("custom"),!(!CheckoutPage.validateInputsCreateToken()||hasToken)&&createToken()))}function createToken(){return cardForm.createCardToken().then((e=>{if(!e.token)throw new Error("cardToken is empty");hasToken||(document.querySelector("#cardTokenId").value=e.token,mercado_pago_submit=!0,hasToken=!0,jQuery("form.checkout, form#order_review").submit())})).catch((e=>{console.warn("Token creation error: ",e)})),!1}function initCardForm(){var e=new MercadoPago(wc_mercadopago_params.public_key);return handleCardFormTimeout(),setCustomCheckoutOnLoad(),new Promise(((o,r)=>{cardForm=e.cardForm({amount:getAmount(),iframe:!0,form:{id:formId,cardNumber:{id:"form-checkout__cardNumber-container",placeholder:"0000 0000 0000 0000",style:{"font-size":"16px",height:"40px",padding:"14px"}},cardholderName:{id:"form-checkout__cardholderName",placeholder:"Ex.: María López"},cardExpirationDate:{id:"form-checkout__expirationDate-container",placeholder:wc_mercadopago_params.placeholders.cardExpirationDate,mode:"short",style:{"font-size":"16px",height:"40px",padding:"14px"}},securityCode:{id:"form-checkout__securityCode-container",placeholder:"123",style:{"font-size":"16px",height:"40px",padding:"14px"}},identificationType:{id:"form-checkout__identificationType"},identificationNumber:{id:"form-checkout__identificationNumber"},issuer:{id:"form-checkout__issuer",placeholder:wc_mercadopago_params.placeholders.issuer},installments:{id:"form-checkout__installments",placeholder:wc_mercadopago_params.placeholders.installments}},callbacks:{onReady:()=>{o()},onFormMounted:function(e){cardFormMounted=!0,e&&console.log("Callback to handle the error: creating the CardForm",e)},onFormUnmounted:function(e){cardFormMounted=!1,CheckoutPage.clearInputs(),setCustomCheckoutUnloaded(),e&&console.log("Callback to handle the error: unmounting the CardForm",e)},onInstallmentsReceived:(e,o)=>{e?console.warn("Installments handling error: ",e):CheckoutPage.setChangeEventOnInstallments(CheckoutPage.getCountry(),o)},onCardTokenReceived:e=>{e&&console.warn("Token handling error: ",e)},onPaymentMethodsReceived:(e,o)=>{try{o?(CheckoutPage.setValue("paymentMethodId",o[0].id),CheckoutPage.setCvvHint(o[0].settings[0].security_code),CheckoutPage.changeCvvPlaceHolder(o[0].settings[0].security_code.length),CheckoutPage.clearInputs(),CheckoutPage.setDisplayOfError("fcCardNumberContainer","remove","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-number","none"),CheckoutPage.setImageCard(o[0].thumbnail),CheckoutPage.installment_amount(o[0].payment_type_id),CheckoutPage.loadAdditionalInfo(o[0].additional_info_needed),CheckoutPage.additionalInfoHandler(additionalInfoNeeded)):(CheckoutPage.setDisplayOfError("fcCardNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-number","flex"))}catch(e){CheckoutPage.setDisplayOfError("fcCardNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-number","flex")}},onSubmit:function(e){e.preventDefault()},onValidityChange:function(e,o){if(e){let r=CheckoutPage.getHelperMessage(o),t=wc_mercadopago_params.input_helper_message[o][e[0].code];r.innerHTML=t||wc_mercadopago_params.input_helper_message[o].invalid_length,"cardNumber"==o&&"invalid_length"!==e[0].code&&(CheckoutPage.setBackground("fcCardNumberContainer","no-repeat #fff"),CheckoutPage.removeAdditionFields(),CheckoutPage.clearInputs());let a=CheckoutPage.findContainerField(o);return CheckoutPage.setDisplayOfError(a,"add","mp-error"),CheckoutPage.setDisplayOfInputHelper(CheckoutPage.inputHelperName(o),"flex")}let r=CheckoutPage.findContainerField(o);return CheckoutPage.setDisplayOfError(r,"removed","mp-error"),CheckoutPage.setDisplayOfInputHelper(CheckoutPage.inputHelperName(o),"none")},onError:function(e){e.forEach((e=>(removeBlockOverlay(),e.message.includes("cardNumber")?(CheckoutPage.setDisplayOfError("fcCardNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-number","flex")):e.message.includes("cardholderName")?(CheckoutPage.setDisplayOfError("fcCardholderName","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-card-holder-name","flex")):e.message.includes("expirationMonth")||e.message.includes("expirationYear")?(CheckoutPage.setDisplayOfError("fcCardExpirationDateContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-expiration-date","flex")):e.message.includes("securityCode")?(CheckoutPage.setDisplayOfError("fcSecurityNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-security-code","flex")):e.message.includes("identificationNumber")?(CheckoutPage.setDisplayOfError("fcIdentificationNumberContainer","add","mp-error"),CheckoutPage.setDisplayOfInputHelper("mp-doc-number","flex")):r(e))))}}})}))}function getAmount(){const e=parseFloat(document.getElementById("mp-amount").value.replace(",",".")),o=parseFloat(document.getElementById("currency_ratio").value.replace(",","."));return String(e*o)}function removeBlockOverlay(){jQuery("form#order_review").length>0&&jQuery(".blockOverlay").css("display","none")}function removeCardFormErrorComponent(e){e.firstElementChild&&e.removeChild(e.firstElementChild)}function getCustomCheckoutElements(){return{loader:document.getElementById("mp-custom-checkout-loader"),container:document.getElementById("mp-custom-checkout-form-container"),error:document.getElementById("mp-custom-checkout-error-container")}}function setCustomCheckoutOnLoad(){cardFormReady=!1;const{loader:e,container:o,error:r}=getCustomCheckoutElements();e.style.display="flex",o.style.display="none",r.style.display="none",removeCardFormErrorComponent(r)}function setCustomCheckoutLoaded(){cardFormReady=!0;const{loader:e,container:o,error:r}=getCustomCheckoutElements();e.style.display="none",o.style.display="block",r.style.display="none"}function setCustomCheckoutUnloaded(){cardFormReady=!1;const{loader:e,container:o,error:r}=getCustomCheckoutElements();e.style.display="flex",o.style.display="none",r.style.display="none"}function setCustomCheckoutError(){cardFormReady=!1;const{loader:e,container:o,error:r}=getCustomCheckoutElements();removeCardFormErrorComponent(r);var t=document.createElement("div"),a=document.createElement("alert-details");a.setAttribute("title",wc_mercadopago_params.custom_checkout_sdk_handler.title),a.setAttribute("description",wc_mercadopago_params.custom_checkout_sdk_handler.description),a.setAttribute("retryButtonText",wc_mercadopago_params.custom_checkout_sdk_handler.retry_button),r.appendChild(t),r.firstChild.appendChild(a),e.style.display="none",o.style.display="none",r.style.display="block"}function cardFormLoad(){document.getElementById("payment_method_woo-mercado-pago-custom").checked?setTimeout((()=>{cardFormMounted||handleCardFormLoad()}),1e3):cardFormMounted&&cardForm.unmount()}function handleCardFormLoad(){initCardForm().then((()=>{setCustomCheckoutLoaded()})).catch((e=>{const o=handleCardFormErrors(e);sendError(o),setCustomCheckoutError(),console.error("Mercado Pago cardForm error: ",o)}))}function handleCardFormErrors(e){if(e.length){const o=[];return e.forEach((e=>{o.push(e.description||e.message)})),o.join(",")}return e.description||e.message}function handleCardFormTimeout(){setTimeout((()=>{cardFormReady||(sendError("mp_wc_cardform_timeout"),setCustomCheckoutError())}),6e4)}function sendError(e){const o={name:"MP_CARDFORM_ERROR",target:"mp_custom_checkout_security_fields_client",message:e,plugin:{version:wc_mercadopago_params.plugin_version},platform:{name:"woocommerce",uri:window.location.href,version:wc_mercadopago_params.platform_version,location:wc_mercadopago_params.location}};navigator.sendBeacon("https://api.mercadopago.com/v1/plugins/melidata/errors",JSON.stringify(o))}form?form.id=formId:formId="order_review",jQuery("form.checkout").on("checkout_place_order_woo-mercado-pago-custom",(function(){return mercadoPagoFormHandler()})),jQuery("body").on("payment_method_selected",(function(){triggeredPaymentMethodSelectedEvent||cardFormLoad()})),jQuery("form#order_review").submit((function(){if(document.getElementById("payment_method_woo-mercado-pago-custom").checked)return mercadoPagoFormHandler();cardFormLoad()})),jQuery(document.body).on("checkout_error",(()=>{hasToken=!1,mercado_pago_submit=!1})),triggeredPaymentMethodSelectedEvent||jQuery("body").trigger("payment_method_selected");